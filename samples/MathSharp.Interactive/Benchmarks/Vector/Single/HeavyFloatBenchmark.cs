using System;
using System.Runtime.InteropServices;
using System.Runtime.Intrinsics;
using System.Runtime.Intrinsics.X86;
using BenchmarkDotNet.Attributes;

using nuint = System.Int64;

namespace MathSharp.Interactive.Benchmarks.Vector.Single
{
    public unsafe class HeavyFloatBenchmark
    {
        private const string crt = "msvcrt";

        [DllImport(crt)]
        private static extern void* malloc(nuint size);

        [DllImport(crt)]
        private static extern void free(void* p);

        private static T* malloc<T>(nuint count) where T : unmanaged => (T*)malloc(count * sizeof(T));

        [GlobalSetup]
        public void Setup()
        {
            p = malloc<float>(size);
        }

        [GlobalCleanup]
        public void Cleanup()
        {
            free(p);
        }

        private float* p;
        private const int size = 16_384 * 100;

        [Benchmark]
        public void Scalar()
        {
            for (var i = 0; i < size; i++)
            {
                var v = Sse.LoadScalarVector128(&p[i]);

                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);
                v = Sse.MultiplyScalar(v, v);
                v = Sse.SqrtScalar(v);

                Sse.StoreScalar(&p[i], v);
            }
        }

        [Benchmark]
        public void Vectorised()
        {
            for (var i = 0; i < size / 8; i++)
            {
                var v = Avx.LoadVector256(&p[i]);

                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);
                v = Avx.Multiply(v, v);
                v = Avx.Sqrt(v);

                Avx.Store(&p[i], v);
            }
        }
    }
}